{{#if (and isCurrentYear (not permission.signup_allowed))}}
  {{#ch-box "Signups for training and/or shifts is not allowed" type="warning" icon="exclamation-circle"}}
    {{#if person.isPastProspective}}
      <p>
        You cannot sign up for trainings and/or shifts because it looks like
        you were interested in volunteering with us some time ago but your account
        isn't in our volunteer intake pipeline for this year.
      </p>

      <p>
        <a href="http://rangers.burningman.org/ranger-application-process/">Click Here</a>
        to read about our intake process for this event cycle, as it may have
        changed since you last applied. All prospective Rangers must reapply each year
        from the start of the process.
      </p>
    {{else if permission.manual_review_window_missed}}
      We are sorry to report that you were not among the first
      {{permission.manual_review_cap}} prospective volunteers to have passed
      the Manual Review. Sadly
      this means that you have missed the window for volunteering with us
      as a Ranger this year. If you have questions or believe you have received
      this message in error, please contact {{vc-email}} .
    {{else}}
      {{#if (eq permission.photo_status "error")}}
        <h3>Oops! There was a problem communicating with our photo server.</h3>
        <p>
          We cannot determine if you have uploaded a photo, or if it has been approved. Please
          check back in a few minutes to see if the problem has resolved. If this
          problems persists, please contact {{admin-email}} for help.
        </p>
        <p>
          We are sorry if this is an inconvenience for you.
        </p>
      {{else if (not-eq permission.photo_status "not-required")}}
        <p>
          You cannot sign up for training and/or shifts because {{deniedReason}}.
        </p>
        {{#if (not-eq permission.photo_status "approved")}}
          <p>
            {{#if (eq permission.photo_status "missing")}}
              Please upload a BMID (lam) photo. Note that photos can take 2-3 days to be
              approved. A new photo may be uploaded on the {{#link-to "me.overview"}}Home Page{{/link-to}}.
            {{else if (eq permission.photo_status "rejected")}}
              The photo was rejected. Please upload a new photo that conforms to the guidelines.
            {{else}}
              Your photo has been submitted and may take up to 2 to 3 days to review. Please check back then.
            {{/if}}
          </p>
        {{/if}}
      {{/if}}

      {{#if (not permission.manual_review_passed)}}
        {{#if (and permission.manual_review_allowed permission.manual_review_url)}}
          <p>
            Please <a href="{{permission.manual_review_url}}">click here</a> to take the Manual Review.
          </p>
        {{else}}
          <strong class="text-danger">Unfortunately, the Manual Review is still
          being worked on.</strong> You may not sign up for shifts, including
          trainings, until the review is ready and you have passed it. Please
          check back later.
        {{/if}}
      {{/if}}
    {{/if}}

    {{#if permission.missing_bpguid}}
      <p>
        Your Clubhouse account is missing your Burner Profile ID (aka BPGUID). Normally, the ID
        is automatically filled in when your Clubhouse account is created however sometimes the
        ID is filled. Contact the Ranger Voluneer Coordinatiors at {{vc-email}} to get this fixed.
      </p>
    {{/if}}

    {{#if (or person.isPastProspective (and (not person.callsign_approved) (not person.isAuditor) (not person.isNonRanger)))}}
      Please email {{vc-email}} if you are interested in
      volunteering with us or if you think you have received this message in error.
    {{/if}}
  {{/ch-box}}
{{else}}
  {{schedule-table slots=signedUpSlots person=person year=year creditsEarned=creditsEarned}}
  <h3>{{if isCurrentYear "Available Shifts" "Past Shifts"}}</h3>
  {{#if availableSlots}}
    {{#if inactiveSlots}}
      {{#ch-alert "warning"}}
        Because you have the Trainer, VC, and/or Admin role, the shift listing may contain inactive shifts, marked with a {{fa-icon "exclamation-triangle"}}, which may not be signed up - yet.
        These shifts are included for verification purposes.
      {{/ch-alert}}
    {{/if}}

    <div class="row mb-1">
      <div class="col-sm-5 col-md-4 col-lg-3 mb-2">
        {{#power-select
            selected=filterDay
            options=dayOptions
            searchEnabled=false
            searchField="title"
            onchange=(action (mut filterDay))
                      as |item| }}
          {{item.title}}
        {{/power-select}}
      </div>
      {{#if inactiveSlots}}
        <div class="col-sm-5 col-md-4 col-lg-3 mb-2">
          {{#power-select
            selected=filterActive
            options=activeOptions
            searchEnabled=false
            onchange=(action (mut filterActive)) as |item| }}
            {{item.title}}
          {{/power-select}}
        </div>
      {{/if}}
    </div>

    <p class="text-muted">Showing {{viewSlots.length}} of {{availableSlots.length}}</p>

    {{#if slotGroups}}
      {{#each slotGroups as |group|}}
        <div class="schedule-table schedule-signup-sheet">
          <div class="schedule-title">{{if group.show (fa-icon "caret-down") (fa-icon "caret-right")}} <a href="#" {{action "toggleGroup" group}}>{{group.title}} ({{group.slots.length}})</a></div>
          {{#if group.show}}
            <div class="schedule-row schedule-header d-sm-none d-md-block">
              <div class="schedule-time">From</div>
              <div class="schedule-time">To</div>
              <div class="schedule-credits">Credits</div>
              <div class="schedule-description">Description</div>
              <div class="schedule-signups">Signups</div>
              <div class="schedule-actions">Actions</div>
            </div>
            {{#each group.slots as |slot|}}
              <div class="schedule-row {{if slot.person_assigned "table-success"}}">
                <div class="schedule-time">
                  {{#if slot.person_assigned}}
                    {{fa-icon "check" title="You are signed up for this shift."}}
                  {{else if (not slot.slot_active)}}
                    {{fa-icon "exclamation-triangle" title="Shift is inactive and may not be signed up for"}}
                  {{/if}}
                  {{shift-format slot.slot_begins}}
                </div>
                <div class="schedule-time">{{shift-format slot.slot_ends}}</div>
                <div class="schedule-credits"><span class="schedule-sm-label">Credits:</span> {{credits-format slot.credits}}</div>
                <div class="schedule-description">
                  <span class="schedule-sm-label">{{group.title}} - </span>{{slot-info-link slot.slot_description slot.slot_url}}
                </div>
                <div class="schedule-signups">{{slot-full-indicator slot.slot_signed_up slot.slot_max}}</div>
                <div class="schedule-actions">
                  <button {{action "showPeople" slot}} class="btn btn-secondary btn-sm" title="View people signed up">{{fa-icon "users" type="fas"}}</button>
                  {{#if slot.person_assigned}}
                    {{#if (or (has-role "admin") (not slot.has_started))}}
                      {{! Only allow admins to remove a sign up that has started}}
                      <button {{action "leaveSlot" slot}} class="btn btn-danger btn-sm" title="Remove from schedule">{{fa-icon "trash-alt" type="fas"}}</button>
                    {{/if}}
                  {{else}}
                    {{#if slot.slot_active}}
                      {{#if (or (not slot.isFull) (not slot.has_started) (has-role "admin"))}}
                        <button {{action "joinSlot" slot}} class="btn btn-primary btn-sm" title="Sign up">{{fa-icon "user-plus" type="fas"}}</button>
                      {{/if}}
                    {{else}}
                      <small class="text-danger">Inactive</small>
                    {{/if}}
                  {{/if}}
                </div>
              </div>
            {{/each}}
          {{/if}}
        </div>
      {{/each}}
    {{else}}
      <div class="text-danger">There are no shifts which match.</div>
    {{/if}}
    <div class="mt-2"><strong>Note:</strong>
      <ul>
        <li>A shift may not be added to or removed from your schedule if the shift has already started.</li>
      </ul>
    </div>
  {{else}}
    <div class="text-danger">There are no shifts available.</div>
  {{/if}}
{{/if}}
