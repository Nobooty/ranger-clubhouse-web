
<span class="d-inline-block">{{fa-icon "question"}} = unverified.</span>
<span class="d-inline-block">{{fa-icon "check"}} = verified.</span>
<span class="d-inline-block">{{fa-icon "exclamation-triangle"}}= needs review.</span>
<span class="d-inline-block">{{fa-icon "thumbs-down" type="far"}} = requested correction rejected.</span>
<span class="d-inline-block">{{fa-icon "thumbs-up" type="far"}} = correction approved, awaiting verify.</span>
<span class="d-inline-block">{{fa-icon "question-circle" type="far"}} = correction needs more info.</span>
<table class="table table-striped table-sm">
  <thead class="thead-light">
    <tr>
      <th>&nbsp;</th>
      <th>From</th>
      <th>To</th>
      <th class="text-right">Time</th>
      <th class="text-right">Credits</th>
      <th>Position</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {{#each timesheets as |ts|}}
      <tr class="{{if ts.isPendingReview "bg-warning"}}">
        <td>
          {{#if ts.verified}}
            {{fa-icon "check"}}
          {{else if ts.isPendingReview}}
            {{fa-icon "exclamation-triangle"}}
          {{else if ts.isRejected}}
            {{fa-icon "thumbs-down" type="far"}}
          {{else if ts.isUnverified}}
            {{fa-icon "question"}}
          {{else if ts.isApproved}}
            {{fa-icon "thumbs-up" type="far"}}
          {{else}}
            &nbsp;
          {{/if}}
        </td>
        <td>{{shift-format ts.on_duty}}</td>
        <td>{{shift-format ts.off_duty}}</td>
        <td class="td-number">
            {{#if ts.off_duty}}
              {{hour-minute-format ts.duration}}
            {{else}}
              <i>On Duty</i>
            {{/if}}
        </td>
        <td class="td-number">
          {{#if ts.off_duty}}
              {{credits-format ts.credits}}
          {{else}}
              &nbsp;
          {{/if}}
        </td>
        <td data-title="Position">{{ts.position.title}}</td>
        <td>
          {{#if ts.off_duty}}
            {{#if canManageTimesheets}}
              <button type="button" class="btn btn-primary btn-sm" {{action "editTimesheetAction" ts}}>Edit</button>
              <button type="button" class="btn btn-secondary btn-sm" {{action "removeTimesheetAction" ts}}>{{fa-icon "trash"}}</button>
            {{/if}}
          {{else}}
            <button type="button" class="btn btn-primary btn-sm" {{action "signoffAction" ts}}>End Shift</button>
          {{/if}}
        </td>
      </tr>
    {{/each}}
    <tr>
      <td colspan="2">&nbsp;</td>
      <td class="text-right">
        Totals
      </td>
      <td class="text-right">
        {{hour-minute-format (sum-column timesheets "duration")}}
      </td>
      <td class="text-right">
        {{credits-format (sum-column timesheets "credits")}}
      </td>
      <td colspan="2">
        &nbsp;
      </td>
    </tr>
    <tr>
      <td colspan="7">
      {{timesheet-position-summary timesheets=timesheets}}
      </td>
    </tr>
  </tbody>
</table>

{{#if editTimesheet}}
{{#ch-form "timesheet" editTimesheet modalBox=true modalTitle="Edit Timesheet" validator=timesheetValidations onSubmit=(action "saveTimesheetAction") onCancel=(action "cancelTimesheetAction") as |f|}}
  <fieldset>
    <legend>
      Time/Position
    </legend>
    <div class="form-row">
      {{f.input "on_duty" label="On Duty" type="datetime" size=20 grid="col-auto"}}
      {{f.input "off_duty" label="Off Duty" type="datetime" size=20 grid="col-auto"}}
      {{f.input "position_id" label="Position" type="select" options=positionOptions grid="col-auto"}}
    </div>
  </fieldset>
  <fieldset>
    <legend>Entry Verification</legend>
    <div class="form-group row">
      <div class="col-auto">
        {{#if editTimesheet.isPendingReview}}
          <span class="text-danger font-weight-bold">This entry needs to be reviewed.</span>
        {{else if editTimesheet.isUnverified}}
          This entry has not been verified yet by the person. No review action is needed at this time.
        {{else if editTimesheet.verified}}
          <span class="text-success font-weight-bold">Entry was verified on {{shift-format editTimesheet.verified_at}} by {{editTimesheet.verified_person.callsign}}. Review is not needed at this time.</span>
        {{/if}}
      </div>
    </div>
    {{#if editVerification}}
      <div class="form-group row">
            <div class="col-auto">Entry marked for verification:</div>
            <div class="col-auto">
              {{f.input "verified" type="radioGroup" options=verifyOptions inline=true}}
          </div>
      </div>
      <div class="form-row">
            {{f.input "notes" label="Correciton request notes:" type="textarea" cols=80 rows=3}}
      </div>
    {{else}}
    <div class="form-row">
      <div class="col-6">Correction Note:</div>
      <div class="col-6 text-right">
        <button class="btn btn-secondary btn-sm" {{action "editVerificationAction"}}>Edit Verification Flag &amp; Note</button>
      </div>
      <div class="mb-3 col-12">{{present-or-not editTimesheet.notes}}</div>
    </div>
    {{/if}}

  </fieldset>
  <fieldset>
    <legend>Entry Review</legend>
    <div class="form-row">
      {{f.input "reviewer_notes" label="Timesheet reviewer response:" type="textarea" cols=80 rows=2
        hint="The user will see any notes entered in above."
      }}
    </div>
    <div class="form-group row">
        <div class="col-auto">Correction Status:</div>
        <div class="col-auto">
          {{f.input "review_status" label="Review Status" type="radioGroup" options=reviewOptions inline=true}}
        </div>
    </div>
</fieldset>
  {{f.submit}}
  {{f.cancel}}
{{/ch-form}}
{{/if}}
