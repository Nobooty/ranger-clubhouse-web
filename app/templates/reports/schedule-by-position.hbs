<YearSelect @title="Schedule By Position" @year={{this.year}} @onChange={{action (mut this.year)}}  />

{{#if this.positions}}
  <p>
    Jump to a position:
  </p>
  <p>
    {{#each this.positions as |position|}}
      <a href {{on "click" (fn this.scrollToPosition position)}}
         class="d-inline-block border p-2 mr-2 mb-2">{{position.title}}</a>
    {{/each}}
  </p>
  <p>
    <button class="btn btn-primary " {{action this.toggleExpandAll}} disabled={{this.isExpanding}}>
      {{if this.expandAll "Hide" "Expand"}} All
    </button>
    {{#if this.isExpanding}}
      <LoadingIndicator @text="Working"/>
    {{/if}}
  </p>
  {{#each this.positions as |position|}}
    <div class="border mb-2" id="position-{{position.id}}">
      <div class="p-2 bg-light-gray">
        <h4><a href {{on "click" (fn this.togglePosition position)}}>
          {{fa-icon (if position.showing "caret-down" "caret-right")}} {{position.title}} </a>
          ({{pluralize position.slots.length "shift"}})</h4>
      </div>
      {{#if position.showing}}
        <table class="table table-sm table-hover table-striped">
          <thead>
          <tr>
            <th class="w-15">From</th>
            <th class="w-15">To</th>
            <th class="w-15">Description</th>
            <th class="w-5 text-right">Sign Ups</th>
            <th class="w-5 text-right">Max</th>
            <th class="w-45">Callsigns</th>
          </tr>
          </thead>

          <tbody>
          {{#each position.slots as |slot|}}
            <tr>
              <td class="w-15">{{shift-format slot.begins}}</td>
              <td class="w-15">{{shift-format slot.ends}}</td>
              <td class="w-15"><PresentOrNot @value={{slot.description}} @empty="-"/></td>
              <td class="w-5 text-right">{{slot.sign_ups.length}}</td>
              <td class="w-5 text-right">{{slot.max}}</td>
              <td class="w-45">
                {{#each slot.sign_ups as |person idx|}}
                  {{~if idx ", "~}}
                  <PersonLink @person={{person}} />
                {{~else}}
                  <b class="text-danger">No sign ups</b>
                {{/each}}
              </td>
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/if}}
    </div>
  {{/each}}
{{else}}
  <b class="text-danger">No {{this.year}} shifts were found.</b>
{{/if}}
