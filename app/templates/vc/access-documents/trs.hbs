<h1>Export Access Documents</h1>

<p>Below are Access Documents in "claimed" status that are suitable
  for exporting into TRS.</p>

<p>1. Select the type of Access Documents you're interested in and
  click "Filter"</p>

<p>2. Click the "Download CSV for Upload to Ticket Request System"
  link at the bottom of the page to download a CSV to upload into TRS.</p>

<p>3. If the upload succeeds, you can click "Mark Selected As Submitted"
  at the bottom of the page to
  marks these puppies as submitted.
  (If some failed, you can uncheck the little check boxes on the left
  for each record. Do this before you click on the button to mark them
  as submitted.)</p>

<p>Note that there is a recommended TRS batch size of not more than
  700 items. (An item is any goodie of any sort.) If you have more
  than 700 items, the system will stop at around 700, and you can then
  upload that batch, mark it as submitted, and get on with the next batch.</p>


{{#if badRecords}}
  <table class="table table-sm table-hover table-box">
    <caption class="text-danger">{{pluralize badRecords.length "record"}} with errors</caption>
    <thead>
      <tr>
        <td>Callsign</td>
        <td>ID</td>
        <td>Type</td>
        <td>Access Date</td>
        <td>Error</td>
      </tr>
    </thead>
    <tbody>
      {{#each badRecords as |rec|}}
        <tr>
          <td>{{person-link person=rec.person page="access-documents"}}</td>
          <td>RAD-{{rec.document.id}}</td>
          <td>{{rec.document.type}}</td>
          <td>{{rec.document.access_date}}</td>
          <td>{{rec.document.error}}</td>
        </tr>
      {{/each}}
    </tbody>
  </table>
{{/if}}

<div class="form-row mb-2">
  <div class="col-auto">
    <label class="col-form-label">Export Filter</label>
  </div>
  <div class="col-auto">
    {{ch-form/select
      name="selectTypes"
      value=filter
      options=filterOptions
      onChange=(action "updateSelectTypes")
      controlClass="form-control"
    }}
  </div>
</div>
{{#if (gt viewRecords.length MAX_BATCH_SIZE)}}
  {{#ch-alert "danger" }}
    The records shown currently exceed the maximum TRS upload batch size of {{MAX_BATCH_SIZE}}. The rows which exceed the limit have been highlighted in yellow.
  {{/ch-alert}}
{{/if}}
<table class="table table-sm table-hover">
  <caption>
    Showing {{pluralize viewRecords.length "record"}} of type "{{filter}}". Selected {{pluralize selectedCount "record"}}.
  </caption>
  <thead>
    <tr>
      <th>&nbsp;</th>
      <th>Callsign</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Email</th>
      <th>Delivery</th>
      <th>Note</th>
    </tr>
  </thead>

  <tbody>
    {{#each viewRecords as |rec idx|}}
      <tr class="{{if (gte idx MAX_BATCH_SIZE) "bg-warning"}}">
        <td>
          {{#if rec.submitted}}
            <span class="text-success">{{fa-icon "check"}}</span>
          {{else if (eq filter "all")}}
            &nbsp;
          {{else}}
            {{input type="checkbox" checked=rec.selected disabled=(eq filter "all")}}
          {{/if}}
        </td>
        <td>{{person-link person=rec.person page="access-documents"}}</td>
        <td>{{rec.person.first_name}}</td>
        <td>{{rec.person.last_name}}</td>
        <td>{{mail-to rec.person.email}}</td>
        <td>{{rec.document.delivery_type}}</td>
        <td>{{rec.note}}</td>
      </tr>
    {{/each}}
  </tbody>
</table>

<button class="btn btn-primary" {{action exportSelectedAction}} disabled={{or (eq selectedCount 0) (eq filter "all")}}>
  {{#if (eq filter "all")}}
    Export Disabled For "All" View
  {{else}}
    Export {{pluralize selectedCount "Selected Document"}}
  {{/if}}
</button>
<button class="btn btn-secondary" {{action markSubmitted}} disabled={{or (eq selectedCount 0) (eq filter "all")}}>Mark Selected As Submitted</button>
{{#if (gt viewRecords.length MAX_BATCH_SIZE)}}
  <div class="text-danger"><b>More than {{MAX_BATCH_SIZE}} selected. Reduce the selection</b></div>
{{/if}}
