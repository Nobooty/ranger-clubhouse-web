<h1>Clubhouse Positions</h1>
<p>
  <b class="text-danger">Contact the Scheduling Gnome or Tech Team about position creation and/or adjustments.</b>
</p>
<div class="row my-3">
    <FormLabel @auto={{true}}>Type filter</FormLabel>
    <div class="col-auto">
        <ChForm::Select @name="typeFilter"
                        @value={{this.typeFilter}}
                        @options={{this.typeOptions}}
                        @onChange={{action (mut this.typeFilter)}} />
    </div>
    <FormLabel>Active Filter</FormLabel>
    <div class="col-auto">
        <ChForm::Select @name="activeFilter"
                        @value={{this.activeFilter}}
                        @options={{this.activeOptions}}
                        @onChange={{action (mut this.activeFilter)}} />
    </div>
    {{#if this.canManagePositions}}
    <div class="col-auto">
        <UiButton @onClick={{this.newAction}}>New Position</UiButton>
    </div>
    {{/if}}
</div>

Showing {{this.viewPositions.length}} of {{this.positions.length}} positions
<div class="overflow-y-auto">
  <table class="table table-striped table-hover table-sm">
    <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Short Title</th>
      <th>Type</th>
      <th>Min / Max</th>
      <th class="text-center">Active</th>
      <th class="text-center">New User Eligible</th>
      <th class="text-center">All Rangers</th>
      <th class="text-center">Count Hrs</th>
      <th class="text-center">On SL report</th>
      <th>Prevent Multi. Enrollments</th>
      <th>Training / Contact Email</th>
      {{#if this.canManagePositions}}
        <th>Action</th>
      {{/if}}
    </tr>
    </thead>

    <tbody>
    {{#each this.viewPositions key="id" as |position|}}
      <tr>
        <td class="text-right">{{position.id}}</td>
        <td>{{position.title}}</td>
        <td>
          <PresentOrNot @value={{position.short_title}} @empty="-"/>
        </td>
        <td>{{position.type}}</td>
        <td class="text-center">{{position.min}} / {{position.max}}</td>
        <td class="text-center">
          <BooleanIcon @value={{position.active}} @falseIcon="times" @falseClass="text-danger"/>
        </td>
        <td class="text-center">
          <BooleanIcon @value={{position.new_user_eligible}} @trueIcon="user"/>
        </td>
        <td class="text-center">
          <BooleanIcon @value={{position.all_rangers}} @trueIcon="users"/>
        </td>
        <td class="text-center">
          <BooleanIcon @value={{position.count_hours}} @trueIcon="clock"/>
        </td>
        <td class="text-center">
          <BooleanIcon @value={{position.on_sl_report}} @trueIcon="list"/>
        </td>
        <td class="text-center">
          <BooleanIcon @value={{position.prevent_multiple_enrollments}} @trueIcon="ban"/>
        </td>
        <td>
          {{#if position.training_position_id}}
            {{pluck position.training_position_id this.positions "title" "-"}}<br>
          {{/if}}
          {{#if position.contact_email}}
            {{mail-to position.contact_email}}
          {{/if}}
        </td>
        {{#if this.canManagePositions}}
          <td class="actions">
            <UiButton @size="sm" @onClick={{fn this.editAction position}}>
              {{fa-icon "edit"}} Edit
            </UiButton>
          </td>
        {{/if}}
      </tr>
    {{/each}}
    </tbody>
  </table>
</div>
{{#if this.position}}
  <ModalDialog @title={{if this.position.isNew "Create Position"
                           (concat "Edit Position ID #" this.position.id " - " this.position.title)}}
               @onEscape={{this.cancelAction}} as |Modal|>
    <ChForm @formId="position-form"
            @formFor={{this.position}}
            @validator={{this.positionValidations}}
            @onSubmit={{this.saveAction}} as |f|>
      <Modal.body>
        <fieldset>
          <legend>Description</legend>
          <FormRow>
          <f.input @name="title" @label="Title" @maxlength={{40}} @size={{40}} @inline={{true}}
                     @hint={{concat (if f.model.title f.model.title.length
                                      "0") " of 40 characters."}} />
            <f.input @name="short_title" @label="Short Title" @maxlength={{6}} @inline={{true}}
                     @hint={{concat (if f.model.short_title f.model.title.short_title
                                      "0") " of 6 characters."}} />
            <f.input @name="type" @type="select" @label="Type" @options={{this.positionTypes}} @inline={{true}}/>
          </FormRow>
        </fieldset>

        <fieldset>
          <legend>Suggested Ranger Counts Per Slot</legend>
          <FormRow>
            <f.input @name="min" @label="Min" @size={{3}} @maxlength={{3}} @inline={{true}}/>
            <f.input @name="max" @label="Max" @size={{3}} @maxlength={{3}} @inline={{true}}/>
          </FormRow>
        </fieldset>

        <fieldset>
          <legend>Active &amp; Grant Flags</legend>
          <FormRow>
            <div class="col-12 text-danger">
              The "Position Sanity Checker" needs be run after deactivating a position in order to revoke the position
              from all accounts. Revocation is not automatic.
            </div>
            <div class="col-12 mt-2">
              <f.input @name="active" @type="checkbox" @label="Active" @inlineCheckbox={{true}}/>
            </div>
          </FormRow>
          <FormRow>
            <div class="col-12 text-danger mb-1">
              After setting the <i>"All Rangers"</i> and/or <i>"Grant to new Prospective accounts"</i> flags,
              the maintenance "Set Ranger Positions" function has to be run to grant the position to existing accounts.
            </div>
            <div class="col-12 mt-2">
              <f.input @name="all_rangers" @type="checkbox"
                       @label="All Rangers (status active / inactive / inactive extension / retired)"/>
            </div>
            <div class="col-12">
              <f.input @name="new_user_eligible" @type="checkbox"
                       @label="Grant to new Prospective accounts"/>
            </div>
          </FormRow>
        </fieldset>
        <fieldset class="mt-2">
          <legend>Misc. Flags</legend>
          <FormRow>
            <div class="col-12">
              <f.input @name="count_hours"
                       @type="checkbox"
                       @label="Hours count towards appreciations (Ranger clothing, meal plans, etc.)"
              />
              <f.input @name="prevent_multiple_enrollments" @type="checkbox"
                       @label="Prevent Multiple Enrollments (usually for Training positions)"
              />
              <f.input @name="on_sl_report"
                       @type="checkbox"
                       @label="For the Shift Lead Report: indicates the person holds this position of interest"
              />
            </div>
          </FormRow>
        </fieldset>

        {{#if (eq f.model.type "Training")}}
          <fieldset>
            <legend>Training</legend>
            <FormRow>
              <div class="col-12">
                This section is relevant when type is "Training". The Training Position is the position
                the person has to have passed in the current year to be allowed to work this position during the event.
              </div>
            </FormRow>
            <FormRow>
              <f.input @name=training_position_id"
                       @label="Training Position"
                       @type="select"
                       @options={{this.trainingOptions}}
                       @inline={{true}}/>
              <f.input @name="contact_email"
                       @label="Contact Email (shift full notification, etc)"
                       @type="text"
                       @size={{40}}
                       @maxlength={{200}}
                       @inline={{true}}/>
            </FormRow>
          </fieldset>
        {{/if}}
      </Modal.body>

      <Modal.footer @noAlign=true>
        <f.submit @label={{if this.position.isNew "Create" "Update"}} @disabled={{this.position.isSaving}} />
        <UiCancelButton @onClick={{this.cancelAction}} @disabled={{this.position.isSaving}} />
        {{#if this.position.isSaving}}
          <LoadingIndicator/>
        {{/if}}
        {{#unless this.position.isNew}}
          <div class="ml-auto">
            <UiButton @type="danger" @onClick={{this.deleteAction}}>
              {{fa-icon "trash"}} Delete Position
            </UiButton>
          </div>
        {{/unless}}
      </Modal.footer>
    </ChForm>
  </ModalDialog>
{{/if}}

