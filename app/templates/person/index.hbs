{{#if editPositions}}
  {{person/position-form positions=positions positionIds=positionIds onSave=(action "savePositions") onCancel=(action "cancelPositions")}}
{{/if}}

{{#if editRoles}}
  {{person/role-form roles=roles roleIds=roleIds onSave=(action "saveRoles") onCancel=(action "cancelRoles")}}
{{/if}}

{{person-photo photo=photo}}

{{#ch-form "person" person  onSubmit=(action "savePerson") as |f|}}
    <div class="form-group row">
      <label class="col-form-label col-form-label-fixed col-sm-2">Callsign</label>
      {{f.input "callsign" type="text" size=35 maxlength=100 wrapClass="col-auto" disabled=(not isAdminMentorOrVC)}}
    </div>

    <div class="form-group row">
      <label class="col-form-label col-form-label-fixed col-sm-2">FKA</label>
      {{f.input "formerly_known_as" type="text" size=35 maxlength=200 wrapClass="col-auto" disabled=(not isAdminMentorOrVC)}}
    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Callsign Approved</label>
      {{f.input "callsign_approved" type="select" wrapClass="col-auto" options=callsignApprovedOptions disabled=(not canChangeApproval)}}
    </div>

    <div class="form-group row">
      <label class="col-form-label col-form-label-fixed col-sm-2">Status</label>
      {{f.input "status" type="select" options=statusOptions wrapClass="col-auto" disabled=(not isAdminMentorOrVC)}}
    </div>

    <div class="form-group row">
        <label class="col-form-label col-form-label-fixed col-sm-2">Personnel</label>
        {{#if isAdmin}}
          {{f.input "user_authorized" type="select" wrapClass="col-auto" options=userAuthorizedOptions}}
          {{f.input "has_note_on_file" label="Note on file" type="checkbox" wrapClass="col-auto mt-2" value=1}}
        {{else}}
          {{#if person.user_authorized}}
            Authorized
          {{else}}
            <span class="text-danger">NOT AUTHORIZED</span>
          {{/if}}
          {{#if person.has_note_on_file}}
            (note on file)
          {{/if}}
        {{/if}}
    </div>

    <div class="form-group form-row">
      <label class="col-form-label col-form-label-fixed col-sm-2">Name</label>
        {{#if isAdminMentorOrVC}}
          {{f.input "first_name" type="text" size=20 maxlength=25 wrapClass="col-auto"}}
          {{f.input "mi" type="text" size=2 maxlength=10 wrapClass="col-auto"}}
          {{f.input "last_name" type="text" size=20 maxlength=25 wrapClass="col-auto"}}
        {{else}}
          <div class="col-sm-10">
            {{person.first_name}} {{person.mi}} {{person.last_name}}
        </div>
        {{/if}}
    </div>

    <div class="form-group row">
        <label class="col-form-label-fixed col-auto">On Site</label>
        <div class="col-sm-10">
          {{f.input "on_site" type="radioGroup" options=onSiteOptions inline=true}}
        </div>
    </div>

    <div class="form-group row">
      <label for="person_position" class="col-form-label col-form-label-fixed col-sm-2">Positions</label>
      <div class="col-sm-10">
        <div class="row col-12 mt-1 mb-2">
          <button type="button" {{action "togglePositions"}} class="btn btn-primary btn-sm mr-2">{{if showPositions "Hide" "Show"}} Positions</button>
          {{#if (or isAdmin isManageAndGrandPosition)}}
            <button type="button" {{action "editPositions"}} class="btn btn-primary btn-sm">Edit Positions</button>
          {{/if}}
        </div>
        {{#if showPositions}}
          <div class="row">
            {{#each positionColumns as |positionColumn| }}
              <div class="col-4">
                {{#each positionColumn as |position|}}
                  {{position.title}}<br>
                {{/each}}
              </div>
            {{/each}}
          </div>
        {{/if}}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-form-label col-form-label-fixed col-sm-2">Roles</label>
      <div class="col-sm-10">
        <div class="row col-12 mt-1 mb-2">
          <button type="button" {{action "toggleRoles"}} class="btn btn-primary btn-sm mr-2">{{if showRoles "Hide" "Show"}} Roles</button>
          {{#if (has-role "admin")}}
            <button type="button" {{action "editRoles"}} class="btn btn-primary btn-sm">Edit Roles</button>
          {{/if}}
        </div>
        {{#if showRoles}}
          <div class="row">
            {{#each roleColumns as |roleColumn| }}
              <div class="col-4">
                {{#each roleColumn as |role|}}
                  {{role.title}}<br>
                {{/each}}
              </div>
            {{/each}}
          </div>
        {{/if}}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Years</label>
      <div class="col-sm-10">
        {{#each person.years as |year|}}{{year}} {{/each}} ({{person.years.length}})
      </div>
    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Vehicles</label>
      <div class="col-sm-10">
        {{f.input "vehicle_paperwork" label="Motorpool Policy" type="checkbox" inline=true}}
        {{f.input "vehicle_insurance_paperwork" label="Vehicle Insurance Paperwork" type="checkbox" inline=true}}
        {{f.input "vehicle_blacklisted" label="Vehicle Blacklisted" type="checkbox" inline=true}}
      </div>

    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Assets</label>
      <div class="col-sm-10">
        {{f.input "asset_authorized" label="Assets Authorized" type="checkbox" inline=true }}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-sm-2 col-form-label-fixed">BMID/Tickets</label>
      <div class="col-sm-10">
          {{#if (or canEditBMIT canEditAccessDocs)}}
            {{#if canEditBMIT}}
              <a href="{{cgo "bmidc" "edit" personId=person.id}}" class="btn btn-primary btn-sm mr-2">Edit BMID</a>
            {{/if}}
            {{#if canEditAccessDocs}}
              <a href="#" class="btn btn-primary btn-sm mr-2">Edit Tickets &amp; Stuff (TODO)</a>
              <a href="{{cgo "accessdoc" "editUserAccessDocs" personId=person.id}}" class="btn btn-primary btn-sm mr-2">Edit Access Docs</a>
            {{/if}}
          {{else}}
            <div class="text-muted">No permission to edit BMID and/or access documents.</div>
          {{/if}}
      </div>
    </div>

    {{#if isAdmin}}
    <div class="form-group row">
      <label class="col-sm-2 col-form-label-fixed">Logs (TODO)</label>
      <div class="col-sm-10">
          <a href="#" class="btn btn-primary btn-sm">Contact</a>
          <a href="#" class="btn btn-primary btn-sm">Broadcast</a>
      </div>
    </div>
    {{/if}}

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Created</label>
      <div class="col-sm-10">
        {{person.create_date}}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">Modified</label>
      <div class="col-sm-10">
        {{person.date_verified}}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-form-label-fixed col-sm-2">&nbsp;</label>
      <div class="col-sm-8">
        {{f.submit label="Save Information" disabled=(not f.model.isDirty)}}
      </div>
      <div class="col-sm-2 ml-auto">
        <button type="button" class="btn btn-secondary btn-sm" {{action "removePerson"}}>Remove</button>
      </div>
    </div>
{{/ch-form}}
